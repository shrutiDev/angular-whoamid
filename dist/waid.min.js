"use strict";angular.module("waid",["ngCookies","waid.core","waid.core.strategy","waid.core.services","waid.core.controllers","waid.core.directives","waid.idm","waid.comments","waid.rating","monospaced.elastic","LocalStorageModule"]).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!1})}]).run(function(waidCore,waidCoreStrategy,waidCoreAppStrategy,waidService){if(waidCore.config.baseTemplatePath="",waidCore.config.version="0.0.41",waidCore.config.setConfig("api",{environment:{development:{url:"dev.whoamid.com:8000/nl/api"},test:{url:"test.whoamid.com:8001/nl/api"},staging:{url:"test.whoamid.com:8002/nl/api"},production:{url:"eu.whoamid.com/nl/api"}}}),waidCore.config.setConfig("core",{templates:{core:"/templates/core/core.html",emoticonsModal:"/templates/core/emoticons-modal.html",modalWindow:"/templates/core/modal/window.html"},translations:{emoticons_people:"Mensen",emoticons_nature:"Natuur",emoticons_objects:"Objecten",emoticons_places:"Plaatsen"}}),"8080"==window.location.port||"8000"==window.location.port)var url=waidCore.config.getConfig("api.environment.development.url");else if("8001"==window.location.port)var url=waidCore.config.getConfig("api.environment.test.url");else if("8002"==window.location.port)var url=waidCore.config.getConfig("api.environment.staging.url");else var url=waidCore.config.getConfig("api.environment.production.url");waidService.initialize(url)}),angular.module("waid.core",["ngCookies","LocalStorageModule"]).service("waidCore",["$rootScope","$cookies","localStorageService",function($rootScope,$cookies,localStorageService){var waid=angular.isDefined($rootScope.waid)?$rootScope.waid:{};return waid.config={},waid.config.mergeRecursive=function(obj1,obj2){for(var p in obj2)try{obj2[p].constructor==Object?obj1[p]=this.mergeRecursive(obj1[p],obj2[p]):obj1[p]=obj2[p]}catch(e){obj1[p]=obj2[p]}return obj1},waid.config.patchConfig=function(key,config){this[key]=this.mergeRecursive(this[key],config)},waid.config.setConfig=function(key,config){this[key]=config},waid.config.getTemplateUrl=function(module,key){return"undefined"==typeof this[module].templates[key]&&console.log(key+" template does not exist!"),waid.config.baseTemplatePath+this[module].templates[key]+"?v="+waid.config.version},waid.config.getTemplate=function(url){return waid.config.baseTemplatePath+url+"?v="+waid.config.version},waid.config.getTranslation=function(module,key){return this[module].translations[key]},waid.config.getConfig=function(key){if(key.indexOf(".")!==-1)var parts=key.split(".");else var parts=new Array(key);if(parts.length>0)for(var config=this,i=0;i<parts.length;i++){if("undefined"!=typeof config[parts[i]]){if("object"==typeof config[parts[i]]){config=config[parts[i]];continue}return config[parts[i]]}return!1}return this[key]},waid.setLastAction=function(type,data){var object={type:type,data:data};localStorageService.set("waid_last_action",object)},waid.getLastAction=function(){var object=localStorageService.get("waid_last_action");return!!object&&object},waid.setLastProfileFieldSet=function(action){localStorageService.set("waid_last_profile_field_set",action)},waid.getLastProfileFieldSet=function(){var data=localStorageService.get("waid_last_profile_field_set");return!!data&&(localStorageService.remove("waid_last_profile_field_set"),data)},waid.clearLastAction=function(){localStorageService.remove("waid_last_action")},waid.clearWaidData=function(){$rootScope.waid.account=!1,$rootScope.waid.application=!1,$rootScope.waid.user=!1,$rootScope.waid.isLoggedIn=!1,$rootScope.waid.token=!1,localStorageService.remove("waid")},waid.clearUserData=function(){$rootScope.waid.user=!1,$rootScope.waid.isLoggedIn=!1,$rootScope.waid.token=!1,waid.saveWaidData()},waid.saveWaidData=function(waid){var encrypted=!1;if(waid){waid.timestamp=Date.now();var jsonData=JSON.stringify(waid),encrypted=CryptoJS.AES.encrypt(jsonData,this.fp).toString()}localStorageService.set("waid",encrypted,"localStorage")},waid.getWaidData=function(){var waid=localStorageService.get("waid");if(waid){var decrypted=CryptoJS.AES.decrypt(waid,this.fp);try{return JSON.parse(decrypted.toString(CryptoJS.enc.Utf8))}catch(err){return!1}}return!1},waid.utils={},waid.user=!1,waid.account=!1,waid.application=!1,waid.isInit=!1,waid.isLoggedIn=!1,waid.isLoading=!1,$rootScope.waid=waid,waid}]),angular.module("waid.core.strategy",["waid.core","waid.core.services"]).service("waidCoreStrategy",function($rootScope,waidCore,waidService,$location,$cookies,$q){waidCore.getAlCodeUrl=function(){var url=$location.absUrl();return 0==$location.$$html5&&$location.absUrl().indexOf("#")==-1&&(url+="#"),url+=$location.absUrl().indexOf("?")==-1||$location.absUrl().indexOf("#")?"?waidAlCode=[code]":"&waidAlCode=[code]"},waidCore.slugify=function(slug){return Slug.slugify($location.absUrl())},waidCore.openTermsAndConditions=function(){$rootScope.$broadcast("waid.core.strategy.openTermsAndConditions")},waidCore.openEmoticons=function(targetId,comment){$rootScope.$broadcast("waid.core.strategy.openEmoticons",{targetId:targetId,comment:comment})},waidCore.logout=function(){$rootScope.$broadcast("waid.idm.strategy.action.logout")},waidCore.logoutAll=function(){$rootScope.$broadcast("waid.idm.strategy.action.logoutAll")},waidCore.openLinkSocialProfile=function(){$rootScope.$broadcast("waid.idm.strategy.openLinkSocialProfile")},waidCore.openUserProfileHome=function(fieldSet){$rootScope.$broadcast("waid.idm.strategy.openUserProfileHome",{fieldSet:fieldSet}),fieldSet&&$rootScope.$broadcast("waid.idm.action.goToFieldSet",fieldSet)},waidCore.openLoginAndRegisterHome=function(){$rootScope.$broadcast("waid.idm.strategy.openLoginAndRegisterHome")},waidCore.openLostLogin=function(){$rootScope.$broadcast("waid.idm.strategy.openLostLogin")},waidCore.openCompleteProfile=function(){$rootScope.$broadcast("waid.idm.strategy.openCompleteProfile")},waidCore.doNotLinkSocialProfile=function(){$rootScope.$broadcast("waid.idm.strategy.action.doNotLinkSocialProfile")},waidCore.doNotCompleteProfile=function(){$rootScope.$broadcast("waid.idm.strategy.action.doNotCompleteProfile")},waidCore.storeBaseData=function(){if(waidCore.user)var user={default_name:waidCore.user.default_name,id:waidCore.user.id,avatar_thumb_50_50:waidCore.user.avatar_thumb_50_50,has_own_avatar:waidCore.user.has_own_avatar};else var user=!1;waidCore.saveWaidData({account:waidCore.account,application:waidCore.application,token:waidCore.token,user:user})},waidCore.initAlCode=function(){var deferred=$q.defer(),waidAlCode=$location.search().waidAlCode;return waidAlCode?waidService.userAutoLoginGet(waidAlCode).then(function(data){deferred.resolve(data),$location.search("waidAlCode",null),"_=_"==$location.hash()&&$location.hash("")},function(data){deferred.reject(data)}):deferred.resolve(),deferred.promise},waidCore.initErrorCode=function(){var waidErrorCode=$location.search().waidErrorCode;waidErrorCode&&($rootScope.$broadcast("waid.core.strategy.errorCode",{errorCode:waidErrorCode}),$location.search("waidErrorCode",null),"_=_"==$location.hash()&&$location.hash(""))},waidCore.preInitialize=function(){},waidCore.initFP=function(){var deferred=$q.defer();return(new Fingerprint2).get(function(result,components){waidCore.fp=result,deferred.resolve(result)}),deferred.promise},waidCore.applicationInit=function(){var deferred=$q.defer();if("undefined"!=typeof waidCore.account&&"undefined"!=typeof waidCore.application&&waidCore.account.id&&waidCore.application.id){var waid=waidCore.getWaidData(),cacheOk=!1;waid&&waid.account&&waid.application&&waidCore.account.id==waid.account.id&&waidCore.application.id==waid.application.id&&(waidCore.account=waid.account,waidCore.application=waid.application,deferred.resolve(),cacheOk=!0),cacheOk||waidService.applicationInitGet(waidCore.account.id,waidCore.application.id).then(function(data){waidCore.account=data.account,waidCore.application=data.application,deferred.resolve()},function(){deferred.reject()})}else deferred.reject();return deferred.promise},waidCore.initAuthentication=function(){var deferred=$q.defer(),waid=waidCore.getWaidData();return waid&&waid.token&&(waidCore.token=waid.token),waid&&waid.user&&(waidCore.user=waid.user),waidCore.token?waidCore.user?(waidCore.isLoggedIn=!0,$rootScope.$broadcast("waid.core.strategy.initAuthentication.ok"),deferred.resolve()):waidService.authenticate().then(function(){waidCore.isLoggedIn=!0,$rootScope.$broadcast("waid.core.strategy.initAuthentication.ok"),deferred.resolve()},function(){waidCore.isLoggedIn=!1,$rootScope.$broadcast("waid.core.strategy.initAuthentication.error"),deferred.resolve()}):(waidCore.isLoggedIn=!1,deferred.resolve()),deferred.promise},waidCore.initialize=function(){waidCore.initFP().then(function(){waidCore.preInitialize();var promises=[];promises.push(waidCore.applicationInit()),promises.push(waidCore.initAuthentication()),$q.all(promises).then(function(){waidCore.initAlCode().then(function(){waidCore.storeBaseData(),waidCore.isInit=!0,$rootScope.$broadcast("waid.core.strategy.isInit")})},function(){}),waidCore.initErrorCode()})},waidCore.profileCheck=function(data){"undefined"!=typeof data.profile_status&&data.profile_status.length>0&&(data.profile_status.indexOf("profile_ok")!==-1?$rootScope.$broadcast("waid.core.strategy.profileCheck.success",data):"undefined"!=typeof data.profile_status&&data.profile_status.indexOf("social_link_not_verified")!==-1?$rootScope.$broadcast("waid.core.strategy.profileCheck.linkProfile",data):"undefined"!=typeof data.profile_status&&data.profile_status.indexOf("missing_profile_data")!==-1&&$rootScope.$broadcast("waid.core.strategy.profileCheck.completeProfile",data))};var currentFieldSet="";$rootScope.$on("waid.idm.action.goToFieldSet",function(event,fieldSet){currentFieldSet=fieldSet}),$rootScope.$on("waid.idm.action.associateSocial",function(event,data){"associate_known_user"==data.action&&waidCore.setLastProfileFieldSet(currentFieldSet)}),$rootScope.$on("waid.idm.action.addEmail.ok",function(event,data){waidCore.setLastProfileFieldSet(currentFieldSet)}),$rootScope.$on("waid.idm.action.lostLogin.ok",function(event,data){waidCore.setLastProfileFieldSet("password")}),$rootScope.$on("waid.core.services.noPermission",function(event,data){waidCore.token&&waidService.userCompleteProfileGet().then(function(data){waidCore.profileCheck(data)})}),$rootScope.$on("waid.core.strategy.initAuthentication.ok",function(event,data){var action=waidCore.getLastAction();"comment_post"==action.type&&waidService.userCommentPost(action.data).then(function(data){$rootScope.$broadcast("waid.core.lastAction.commentPost",data)}),"rating_post"==action.type&&waidService.ratingPost(action.data).then(function(data){$rootScope.$broadcast("waid.core.lastAction.ratingPost",data)}),waidCore.clearLastAction()}),$rootScope.$on("waid.services.application.userProfile.patch.ok",function(event,data){waidCore.user=data,waidCore.storeBaseData()}),$rootScope.$on("waid.services.application.userProfile.get.ok",function(event,data){waidCore.user=data,waidCore.storeBaseData()}),$rootScope.$on("waid.idm.strategy.action.doNotLinkSocialProfile",function(event,data){waidCore.logout()}),$rootScope.$on("waid.idm.strategy.action.doNotCompleteProfile",function(event,data){waidCore.logout()}),$rootScope.$on("waid.services.application.userLogin.post.ok",function(event,data){waidCore.token=data.token,waidCore.initAuthentication(),waidCore.storeBaseData(),waidCore.profileCheck(data)}),$rootScope.$on("waid.services.application.userAutoLogin.get.ok",function(event,data){waidCore.token=data.token,waidCore.initAuthentication(),waidCore.storeBaseData(),waidCore.profileCheck(data)}),$rootScope.$on("waid.services.application.userLinkSocialProfile.post.ok",function(event,data){waidCore.initAuthentication(),waidCore.profileCheck(data)}),$rootScope.$on("waid.idm.strategy.action.logout",function(event){waidService.userLogoutPost().then(function(){waidCore.clearUserData()},function(){waidCore.clearUserData()})}),$rootScope.$on("waid.idm.strategy.action.logoutAll",function(event){waidService.userLogoutAllPost().then(function(){waidCore.clearUserData()},function(){waidCore.clearUserData()})})}),angular.module("waid.core.services",["waid.core"]).service("waidService",function($q,$http,$cookies,$rootScope,$location,waidCore,$window){var service={API_URL:"",apiVersion:"v1",token:null,authenticated:!1,running:[],request:function(args){var that=this;$http.defaults.headers.common["X-CSRFToken"]=$cookies.get("csrftoken"),$http.defaults.headers.common["Content-Type"]="application/json",null!=waidCore.token&&""!=waidCore.token&&"null"!=waidCore.token?$http.defaults.headers.common.Authorization="Token "+waidCore.token:$http.defaults.headers.common.Authorization=null,$http.defaults.headers.common.FPID=waidCore.fp,$http.defaults.headers.common.CID="AngularJS "+waidCore.config.version;var headers={};"undefined"!=typeof args.headers&&angular.extend(headers,args.headers),params=args.params||{},args=args||{};var deferred=$q.defer(),url=args.url,method=args.method||"GET",params=params,data=args.data||{};return that.running.push(url),waidCore.isLoading=!0,$http({url:url,method:method.toUpperCase(),headers:headers,params:params,data:data}).then(angular.bind(this,function(response){var index=this.running.indexOf(url);index>-1&&(this.running.splice(index,1),this.running.length>0?waidCore.isLoading=!0:waidCore.isLoading=!1),deferred.resolve(response.data,response.status)}),angular.bind(this,function(response){var index=this.running.indexOf(url);index>-1&&(this.running.splice(index,1),this.running.length>0?waidCore.isLoading=!0:waidCore.isLoading=!1),response.data&&(response.data.status=response.status),"undefined"!=typeof response.data&&"undefined"!=typeof response.data.error&&"undefined"!=response.data.error.code&&"invalid_authentication_credentials"==response.data.error.code&&that._clearAuthorizationData(),403==response.data&&$rootScope.$broadcast("waid.core.services.noPermission",response.data),0==status&&(""==response.data&&(response.data={},response.data.status=0,response.data.non_field_errors=["Could not connect. Please try again."]),null==response.data&&(response.data={},response.data.status=0,response.data.non_field_errors=["Server timed out. Please try again."])),deferred.reject(response.data,response.data.status,response.headers,response.config)})),deferred.promise},_clearAuthorizationData:function(){this.authenticated=!1,waidCore.token=null},_makeFileRequest:function(method,type,path,broadcast,data){var that=this,deferred=$q.defer();return this.request({method:method,url:that._buildUrl(type,path),data:data,headers:{"Content-Type":void 0}}).then(function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".ok",data),deferred.resolve(data)},function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".error",data),deferred.reject(data)}),deferred.promise},_buildUrl:function(type,path){switch(type){case"admin":return this.API_URL+"/admin/"+this.apiVersion+"/"+waidCore.account.id+path;case"app":return this.API_URL+"/application/"+this.apiVersion+"/"+waidCore.account.id+"/"+$rootScope.waid.application.id+path;case"public":return this.API_URL+"/public/"+this.apiVersion+path;default:return""}},_makeRequest:function(method,type,path,broadcast,data,skipIsInit){var that=this;if(waidCore.isInit||"undefined"!=typeof skipIsInit&&1==skipIsInit){var deferred=$q.defer();return that.request({method:method,url:that._buildUrl(type,path),data:data}).then(function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".ok",data),deferred.resolve(data)},function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".error",data),deferred.reject(data)}),deferred.promise}var deferred=$q.defer(),unregister=$rootScope.$on("waid.core.strategy.isInit",function(event){that.request({method:method,url:that._buildUrl(type,path),data:data}).then(function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".ok",data),deferred.resolve(data),unregister()},function(data){$rootScope.$broadcast("waid.services."+broadcast+"."+method.toLowerCase()+".error",data),deferred.reject(data),unregister()})});return deferred.promise},makeExternalRequest:function(method,url,data){var deferred=$q.defer();return this.request({method:method,url:url,data:data,headers:{"Content-Type":void 0}}).then(function(data){deferred.resolve(data)},function(data){deferred.reject(data)}),deferred.promise},userLinkSocialProfilePost:function(data){return this._makeRequest("POST","app","/user/link-social-profile/","application.userLinkSocialProfile",data)},userLinkSocialProfileDelete:function(data){return this._makeRequest("DELETE","app","/user/link-social-profile/","application.userLinkSocialProfile")},userAssociateSocialDelete:function(provider){return this._makeRequest("DELETE","app","/user/associate-social/"+provider+"/","application.userAssociateSocial")},userRegisterPost:function(data){return"undefined"!=typeof data.return_url&&""!=data.return_url||(data.return_url=waidCore.getAlCodeUrl()),this._makeRequest("POST","app","/user/register/","application.userRegister",data)},userCompleteProfilePost:function(data){return"undefined"!=typeof data.return_url&&""!=data.return_url||(data.return_url=waidCore.getAlCodeUrl()),this._makeRequest("POST","app","/user/complete-profile/","application.userCompleteProfile",data)},userCompleteProfileGet:function(){return this._makeRequest("GET","app","/user/complete-profile/","application.userCompleteProfile")},userLoginPost:function(data){this._clearAuthorizationData();return this._makeRequest("POST","app","/user/login/","application.userLogin",data).then(function(data){return data})},userAutoLoginGet:function(code){return this._clearAuthorizationData(),this._makeRequest("GET","app","/user/autologin/"+code+"/","application.userAutoLogin",null,!0).then(function(data){return data})},userLostLoginPost:function(data){return this._clearAuthorizationData(),"undefined"!=typeof data.return_url&&""!=data.return_url||(data.return_url=waidCore.getAlCodeUrl()),this._makeRequest("POST","app","/user/lost-login/","application.userLostLogin",data)},userLogoutPost:function(){var that=this;return this._makeRequest("POST","app","/user/logout/","application.userLogout").then(function(data){return that._clearAuthorizationData(),data})},userLogoutAllPost:function(){var that=this;return this._makeRequest("POST","app","/user/logout-all/","application.userLogoutAll").then(function(data){return that._clearAuthorizationData(),data})},userProfileGet:function(){return this._makeRequest("GET","app","/user/profile/","application.userProfile")},userPasswordPut:function(data){return this._makeRequest("PUT","app","/user/password/","application.userPassword",data)},userProfilePatch:function(data){return this._makeRequest("PATCH","app","/user/profile/","application.userProfile",data)},userApplicationMetadataPost:function(data){return this._makeRequest("POST","app","/user/application/metadata/","application.userMetadata",data)},userApplicationMetadataGet:function(){return this._makeRequest("GET","app","/user/application/metadata/","application.userMetadata")},userUsernamePut:function(data){return this._makeRequest("PUT","app","/user/username/","application.userUsername",data)},userEmailListGet:function(){return this._makeRequest("GET","app","/user/email/","application.userEmailList")},userEmailPost:function(data){return"undefined"!=typeof data.return_url&&""!=data.return_url||(data.return_url=waidCore.getAlCodeUrl()),this._makeRequest("POST","app","/user/email/","application.userEmail",data)},userEmailDelete:function(id){return this._makeRequest("DELETE","app","/user/email/"+id+"/","application.userEmail")},userTelephoneListGet:function(){return this._makeRequest("GET","app","/user/telephone/","application.userTelephoneList")},userTelephonePost:function(data){return this._makeRequest("POST","app","/user/telephone/","application.userTelephone",data)},userTelephonePut:function(id,data){return this._makeRequest("PUT","app","/user/telephone/"+id+"/","application.userTelephone",data)},userTelephoneDelete:function(id){return this._makeRequest("DELETE","app","/user/telephone/"+id+"/","application.userTelephone")},userAddressListGet:function(){return this._makeRequest("GET","app","/user/address/","application.userAddressList")},userAddressPost:function(data){return this._makeRequest("POST","app","/user/address/","application.userAddress",data)},userAddressPut:function(id,data){return this._makeRequest("PUT","app","/user/address/"+id+"/","application.userAddress",data)},userAddressDelete:function(id){return this._makeRequest("DELETE","app","/user/address/"+id+"/","application.userAddress")},userAvatarPut:function(fd){return this._makeFileRequest("PUT","app","/user/avatar/","application.userAvatar",fd)},socialProviderListGet:function(){return this._makeRequest("GET","app","/social/providers/","application.socialProviderList")},userCommentPatch:function(id,data){return this._makeRequest("PATCH","app","/user/comment/"+id+"/","application.userComment",data)},userCommentPost:function(data){return"undefined"!=typeof data.object_id&&"currenturl"==data.object_id&&(data.object_id=waidCore.slugify($location.absUrl())),data.url=$location.absUrl(),this._makeRequest("POST","app","/user/comment/","application.userComment",data)},userCommentDelete:function(id){return this._makeRequest("DELETE","app","/user/comment/"+id+"/","application.userComment")},userCommentListGet:function(params){if("undefined"!=typeof params){"undefined"!=typeof params.object_id&&"currenturl"==params.object_id&&(params.object_id=waidCore.slugify($location.absUrl()));var query="?"+$.param(params)}else var query="";return this._makeRequest("GET","app","/user/comment/"+query,"application.userCommentList")},commentListGet:function(params){if("undefined"!=typeof params){"undefined"!=typeof params.object_id&&"currenturl"==params.object_id&&(params.object_id=waidCore.slugify($location.absUrl()));var query="?"+$.param(params)}else var query="";return this._makeRequest("GET","app","/comment/"+query,"application.commentList")},commentVotePost:function(id,vote){var data={vote:vote};return this._makeRequest("POST","app","/comment/"+id+"/vote/","application.commentVote",data)},commentMarkPost:function(id,mark){var data={mark:mark};return this._makeRequest("POST","app","/comment/"+id+"/mark/","application.commentMark",data)},ratingPost:function(data){return"undefined"!=typeof data.object_id&&"currenturl"==data.object_id&&(data.object_id=waidCore.slugify($location.absUrl())),data.url=$location.absUrl(),this._makeRequest("POST","app","/rating/","application.rating",data)},ratingGet:function(object_id){return this._makeRequest("GET","app","/rating/"+object_id+"/","application.rating")},articlesListGet:function(){return this._makeRequest("GET","app","/articles/","application.articlesList")},articlesGet:function(id){return this._makeRequest("GET","app","/articles/"+id+"/","application.articles")},applicationInitGet:function(){return this._makeRequest("GET","app","/application/init/","application.init",{},!0)},documentGet:function(doc){return this._makeRequest("GET","app","/docs/"+doc+"/","applicationDocument")},adminUserAvatarDelete:function(id){return this._makeRequest("DELETE","admin","/user/"+id+"/avatar/","admin.userAvatar")},adminUserListGet:function(params){if("undefined"!=typeof params)var query="?"+$.param(params);else var query="";return this._makeRequest("GET","admin","/user/"+query,"admin.userList")},adminUserPatch:function(id,data){return this._makeRequest("PATCH","admin","/user/"+id+"/","admin.user",data)},adminUserGet:function(id){return this._makeRequest("GET","admin","/user/"+id+"/","admin.user")},adminCommentListGet:function(params){if("undefined"!=typeof params)var query="?"+$.param(params);else var query="";return this._makeRequest("GET","admin","/comment/"+query,"admin.commentList")},adminCommentPatch:function(id,data){return this._makeRequest("PATCH","admin","/comment/"+id+"/","admin.comment",data)},adminCommentDelete:function(id){return this._makeRequest("DELETE","admin","/comment/"+id+"/","admin.comment")},adminDefaultEmailTemplatesGet:function(){return this.adminDefaultEmailTemplatesGetRunning||(this.adminDefaultEmailTemplatesGetRunning=this._makeRequest("GET","admin","/default-email-templates/","application.adminDefaultEmailTemplates")),this.adminDefaultEmailTemplatesGetRunning},adminAccountGet:function(){return this._makeRequest("GET","admin","/account/","admin.account")},adminAccountPatch:function(data){return this._makeRequest("PATCH","admin","/account/","admin.account",data)},adminApplicationListGet:function(){return this._makeRequest("GET","admin","/application/","admin.applicationList")},adminApplicationGet:function(id){return this._makeRequest("GET","admin","/application/"+id+"/","admin.application")},adminApplicationPatch:function(data){return this._makeRequest("PATCH","admin","/application/"+data.id+"/","admin.application",data)},publicAccountGet:function(account){return this._makeRequest("GET","public","/account/"+account+"/","public.account",null,!0)},publicAccountCreatePost:function(data){return data.redirect_to_url=$location.absUrl()+"admin/"+data.slug+"/",this._makeRequest("POST","public","/account/create/","admin.accountCreate",data,!0)},authenticate:function(){var that=this,deferred=$q.defer();return null!=waidCore.token&&""!=waidCore.token&&"null"!=waidCore.token?this._makeRequest("GET","app","/user/profile/","application.userProfile",null,!0).then(function(data){that.authenticated=!0,waidCore.user=data,$rootScope.$broadcast("waid.services.authenticate.ok",that),deferred.resolve(data)},function(data){that.authenticated=!1,$rootScope.$broadcast("waid.services.authenticate.error",that),deferred.reject(data)}):(that.authenticated=!1,$rootScope.$broadcast("waid.services.authenticate.none"),deferred.reject()),deferred.promise},initialize:function(url){return this.API_URL=$window.location.protocol+"//",this.API_URL+=url,this}};return service.initialize(),service}),angular.module("waid.core.controllers",["waid.core","waid.core.services","waid.idm.controllers","waid.core.strategy","waid.core.app.strategy"]).controller("WAIDCoreEmoticonModalCtrl",function($scope,$rootScope,comment,selectionStart){$scope.addEmoji=function(emoji){comment=comment.slice(0,selectionStart)+emoji+comment.slice(selectionStart),$rootScope.waid.closeEmoticonsModal(comment)},$scope.emoticons={people:["😄","😆","😊","😃","😏","😍","😘","😚","😳","😌","😆","😁","😉","😜","😝","😀","😗","😙","😛","😴","😟","😦","😧","😮","😬","😕","😯","😑","😒","😅","😓","😥","😩","😔","😞","😖","😨","😰","😣","😢","😭","😂","😲","😱","😫","😠","😡","😤","😪","😋","😷","😎","😵","👿","😈","😐","😶","😇","👽","💛","💙","💜","❤","💚","💔","💓","💗","💕","💞","💘","💖","✨","⭐","🌟","💫","💥","💥","💢","❗","❓","❕","❔","💤","💨","💦","🎶","🎵","🔥","💩","💩","💩","👍","👍","👎","👎","👌","👊","👊","✊","✌","👋","✋","✋","👐","☝","👇","👈","👉","🙌","🙏","👆","👏","💪","🏃","🏃","👫","👪","👬","👭","💃","👯","🙆","🙅","💁","🙋","👰","🙎","🙍","🙇","💏","💑","💆","💇","💅","👦","👧","👩","👨","👶","👵","👴","👱","👲","👳","👷","👮","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💂","💀","🐾","👄","💋","💧","👂","👀","👃","👅","💌","👤","👥","💬","💭"],nature:["☀","☂","☁","❄","☃","⚡","🌀","🌁","🌊","🐱","🐶","🐭","🐹","🐰","🐺","🐸","🐯","🐨","🐻","🐷","🐽","🐮","🐗","🐵","🐒","🐴","🐎","🐫","🐑","🐘","🐼","🐍","🐦","🐤","🐥","🐣","🐔","🐧","🐢","🐛","🐝","🐜","🐞","🐌","🐙","🐠","🐟","🐳","🐋","🐬","🐄","🐏","🐀","🐃","🐅","🐇","🐉","🐐","🐓","🐕","🐖","🐁","🐂","🐲","🐡","🐊","🐪","🐆","🐈","🐩","🐾","💐","🌸","🌷","🍀","🌹","🌻","🌺","🍁","🍃","🍂","🌿","🍄","🌵","🌴","🌲","🌳","🌰","🌱","🌼","🌾","🐚","🌐","🌞","🌝","🌚","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌜","🌛","🌙","🌍","🌎","🌏","🌋","🌌","⛅"],objects:["🎍","💝","🎎","🎒","🎓","🎏","🎆","🎇","🎐","🎑","🎃","👻","🎅","🎄","🎁","🔔","🔕","🎋","🎉","🎊","🎈","🔮","💿","📀","💾","📷","📹","🎥","💻","📺","📱","☎","☎","📞","📟","📠","💽","📼","🔉","🔈","🔇","📢","📣","⌛","⏳","⏰","⌚","📻","📡","➿","🔍","🔎","🔓","🔒","🔏","🔐","🔑","💡","🔦","🔆","🔅","🔌","🔋","📲","✉","📫","📮","🛀","🛁","🚿","🚽","🔧","🔩","🔨","💺","💰","💴","💵","💷","💶","💳","💸","📧","📥","📤","✉","📨","📯","📪","📬","📭","📦","🚪","🚬","💣","🔫","🔪","💊","💉","📄","📃","📑","📊","📈","📉","📜","📋","📆","📅","📇","📁","📂","✂","📌","📎","✒","✏","📏","📐","📕","📗","📘","📙","📓","📔","📒","📚","🔖","📛","🔬","🔭","📰","🏈","🏀","⚽","⚾","🎾","🎱","🏉","🎳","⛳","🚵","🚴","🏇","🏂","🏊","🏄","🎿","♠","♥","♣","♦","💎","💍","🏆","🎼","🎹","🎻","👾","🎮","🃏","🎴","🎲","🎯","🀄","🎬","📝","📝","📖","🎨","🎤","🎧","🎺","🎷","🎸","👞","👡","👠","💄","👢","👕","👕","👔","👚","👗","🎽","👖","👘","👙","🎀","🎩","👑","👒","👞","🌂","💼","👜","👝","👛","👓","🎣","☕","🍵","🍶","🍼","🍺","🍻","🍸","🍹","🍷","🍴","🍕","🍔","🍟","🍗","🍖","🍝","🍛","🍤","🍱","🍣","🍥","🍙","🍘","🍚","🍜","🍲","🍢","🍡","🍳","🍞","🍩","🍮","🍦","🍨","🍧","🎂","🍰","🍪","🍫","🍬","🍭","🍯","🍎","🍏","🍊","🍋","🍒","🍇","🍉","🍓","🍑","🍈","🍌","🍐","🍍","🍠","🍆","🍅","🌽"],places:["🏠","🏡","🏫","🏢","🏣","🏥","🏦","🏪","🏩","🏨","💒","⛪","🏬","🏤","🌇","🌆","🏯","🏰","⛺","🏭","🗼","🗾","🗻","🌄","🌅","🌠","🗽","🌉","🎠","🌈","🎡","⛲","🎢","🚢","🚤","⛵","⛵","🚣","⚓","🚀","✈","🚁","🚂","🚊","🚞","🚲","🚡","🚟","🚠","🚜","🚙","🚘","🚗","🚗","🚕","🚖","🚛","🚌","🚍","🚨","🚓","🚔","🚒","🚑","🚐","🚚","🚋","🚉","🚆","🚅","🚄","🚈","🚝","🚃","🚎","🎫","⛽","🚦","🚥","⚠","🚧","🔰","🏧","🎰","🚏","💈","♨","🏁","🎌","🏮","🗿","🎪","🎭","📍","🚩"]}}).controller("WAIDCoreCtrl",function($scope,$rootScope,waidCore){angular.isDefined($rootScope.config)&&waidCore.config.patchConfig($rootScope.config),waidCore.account={id:!!angular.isDefined($scope.accountId)&&$scope.accountId},waidCore.application={id:!!angular.isDefined($scope.applicationId)&&$scope.applicationId},waidCore.initialize(),$rootScope.waid=waidCore,$scope.waid=waidCore}),angular.module("waid.core.directives",["waid.core","waid.core.controllers","waid.core.services"]).directive("waid",function(waidCore){return{scope:{config:"@",applicationId:"@",accountId:"@"},restrict:"E",controller:"WAIDCoreCtrl",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("core","core")}}}).directive("waidTranslation",function(waidCore){return{restrict:"E",template:function(elem,attr){return waidCore.config.getTranslation(attr.module,attr.key)}}}).directive("waidRenderTemplate",function(waidCore,waidService,$q){return{restrict:"E",template:function(elem,attr){return attr.template}}}),angular.module("waid.idm",["waid.core","waid.idm.controllers","waid.idm.directives"]).run(function(waidCore,waidCoreStrategy,waidCoreAppStrategy,waidService){waidCore.config.setConfig("idm",{templates:{profile:"/templates/idm/profile.html",overview:"/templates/idm/overview.html",userProfileNavbar:"/templates/idm/user-profile-navbar.html",userProfileStatusButton:"/templates/idm/user-profile-status-button.html",termsAndConditionsModal:"/templates/idm/terms-and-conditions-modal.html",completeProfileModal:"/templates/idm/complete-profile-modal.html",linkSocialProfileModal:"/templates/idm/link-social-profile-modal.html",lostLoginModal:"/templates/idm/lost-login-modal.html",loginAndRegisterModal:"/templates/idm/login-and-register-modal.html",userProfileModal:"/templates/idm/user-profile-modal.html",loginAndRegisterHome:"/templates/idm/login-and-register-home.html",socialLogin:"/templates/idm/social-login.html",login:"/templates/idm/login.html",register:"/templates/idm/register.html",lostLogin:"/templates/idm/lost-login.html",userProfileMenu:"/templates/idm/user-profile-menu.html",userProfileHome:"/templates/idm/user-profile-home.html",linkSocialProfile:"/templates/idm/link-social-profile.html",
associatedSocialAccounts:"/templates/idm/associated-social-accounts.html"},translations:{link_social_profile_intro:"We hebben een bestaande account gevonden waarmee we de nieuwe social login willen koppelen. Ter beveiliging vragen we nogmaals je wachtwoord om deze koppeling af te ronden.",link_social_profile_modal_title:"Bestaande account koppelen aan nieuwe social account.",link_social_profile_modal_close_button:"Sluiten en niet koppelen",link_social_profile_link_button:"Doorgaan en social account koppelen","auth-cancelled":"Authenticatie is geannuleerd.","auth-failed":"Authenticatie is gefaald. Ons excuus voor het ongemak.","auth-unknown-error":"Een onbekende fout heeft zich voortgedaan. Ons excuus voor het ongemak.","auth-missing-parameter":"A needed parameter to continue the process was missing, usually raised by the services that need some POST data like myOpenID.","auth-state-missing":"The state parameter is missing from the server response.","auth-state-forbidden":"The state parameter returned by the server is not the one sent.","auth-token-error":"Geen permissie of toegang met de token. Kan hierdoor niet authenticeren. Controlleer de instellingen in de admin.","auth-already-associated":"Een andere gebruiker is al geassocieerd met de social account.","system-error":"Systeem fout. Ons excuus voor het ongemak.",edit:"Wijzigen",complete_profile_intro:"Om verder te gaan met jouw account hebben we wat extra gegevens nodig...",complete_profile_email_allready_sent:"Er was al een bevestigings e-mail naar je toe gestuurd. Heb je deze niet ontvangen? voer opnieuw een geldig e-mailadres in en dan word er een nieuwe activatie link toegestuurd.","delete":"Verwijderen",male:"Man",female:"Vrouw",emails:"E-mail adressen",avatar:"Profielfoto",display_name:"Profielnaam",date_of_birth:"Geboortedatum",gender:"Geslacht",overview:"Overzicht",main:"Algemeen",telephone_numbers:"Telefoon nummers",telephone_number:"Telefoon nummer",edit_overview:"Algemene gegevens aanpassen",interests:"Interesses",like_tags:"Wat vind je leuk?",like_tags_help:"Probeer in kernwoorden te antwoorden, bijvoorbeeld: vakantie, Bali, fietsen, muziek, auto's, Audi etc. We proberen interessante content met deze woorden voor je te selecteren.",dislike_tags:"Wat vind je echt niet leuk?",edit_interests:"Interesses aanpassen",email_addresses:"E-mail adressen",edit_email_addresses:"E-mail adressen aanpassen",username:"Gebruikersnaam",edit_username:"Gebruikersnaam wijzigen",password:"Wachtwoord",password_confirm:"Wachtwoord bevestiging",edit_password:"Wachtwoord wijzigen",login_and_register_home_social_login_title:"Log in met jouw Social account",login_and_register_home_login_title:"Inloggen",login_and_register_home_register_title:"Registreren",login_and_register_home_social_login_intro:"<p>Maak gebruik van jouw social media account bij Facebook, Twitter of LinkedIn om snel en gemakkelijk in te loggen.</p>",login_and_register_modal_close_button:"Sluiten",login_and_register_modal_title:"Inloggen of registreren",complete_profile_modal_title:"Bevestig uw gegevens",complete_profile_modal_close_button:"Niet verdergaan en uitloggen",login_lost_login_link:"Login gegevens kwijt?",login_submit:"Inloggen",login_form_password_label:"Wachtwoord",login_form_username_label:"Gebruikersnaam",lost_login_modal_title:"Login gegevens kwijt?",lost_login_modal_close_button:"Sluiten",lost_login_submit_button:"Inlog gegevens ophalen",lost_lostin_form_email:"E-mailadres",register_form_username:"Gebruikersnaam",register_form_email:"E-mailadres",register_form_password:"Wachtwoord",register_submit_register:"Registreren",register_submit_register_complete:"Registratie afronden",terms_and_conditions_check:'Ik ga akkoord met de <a ng-click="waid.openTermsAndConditionsModal()">algemene voorwaarden</a>.',terms_and_condition_modal_title:"Algemene voorwaarden",terms_and_condition_modal_close:"Sluiten",telephone_number_help:"Voer hier een geldig nummer in het formaat : (landnummer) (netnummer/06) (telefoon)",addresses:"Adressen",address:"Adres",city:"Stad",zipcode:"Postcode",country:"Land",about_public:"Over mij",about_public_help:"Publiekelijke informatie zichtbaar voor iedereen",first_name:"Voornaam",surname_prefix:"Tussenvoegsel",surname:"Achternaam",associated_social_accounts:"Social koppelingen",associated_social_accounts_intro:"Met deze social koppelingen kan je snel inloggen op onze site. Klik op een van de social sites om te koppelen of te ontkoppelen."},profileDefinition:{fieldSet:[{key:"overview",order:10,templateKey:"overview"},{key:"main",order:20,fieldDefinitions:[{order:10,name:"display_name",labelKey:"display_name",type:"input"},{order:20,name:"first_name",labelKey:"first_name",type:"input"},{order:30,name:"surname_prefix",labelKey:"surname_prefix",type:"input"},{order:40,name:"surname",labelKey:"surname",type:"input"},{order:50,name:"date_of_birth",labelKey:"date_of_birth",type:"date"},{order:60,name:"gender",labelKey:"gender",type:"gender"},{order:70,name:"avatar_thumb_50_50",labelKey:"avatar",type:"avatar"},{order:80,name:"about_public",labelKey:"about_public",helpKey:"about_public_help",type:"textarea"}]},{key:"interests",order:30,fieldDefinitions:[{order:10,name:"like_tags",labelKey:"like_tags",helpKey:"like_tags_help",type:"textarea"},{order:20,name:"dislike_tags",labelKey:"dislike_tags",type:"textarea"}]},{key:"emails",order:40,noSaveButton:!0,fieldDefinitions:[{order:10,noLabel:!0,name:"emails",labelKey:"emails",type:"multipleEmail",storageType:"none"}]},{key:"telephone_numbers",hideFromOverview:!0,order:50,fieldDefinitions:[{order:10,noLabel:!0,name:"telephone_numbers",labelKey:"telephone_numbers",numberKey:"telepone_number",helpKey:"telephone_number_help",type:"multipleTelephone",hideFromOverview:!0,storageType:"none"}]},{key:"addresses",hideFromOverview:!0,order:60,fieldDefinitions:[{order:10,noLabel:!0,name:"addresses",labelKey:"addresses",type:"multipleAddresses",hideFromOverview:!0,storageType:"none"}]},{key:"associated_social_accounts",introKey:"associated_social_accounts_intro",order:70,noSaveButton:!0,fieldDefinitions:[{order:10,noLabel:!0,name:"associated_social_accounts",labelKey:"associated_social_accounts",type:"associatedSocialAccounts",storageType:"none"}]},{key:"username",order:70,fieldDefinitions:[{order:10,name:"username",labelKey:"username",type:"input",storageType:"username"}]},{key:"password",order:80,fieldDefinitions:[{order:10,name:"password",labelKey:"password",type:"password",storageType:"password"},{order:20,name:"password_confirm",labelKey:"password_confirm",type:"password",hideFromOverview:!0,storageType:"password"}]}]}})}),angular.module("waid.idm.controllers",["waid.core"]).controller("WAIDIDMTermsAndConditionsCtrl",function($scope,$rootScope,waidService,$interpolate){waidService.documentGet("terms-and-conditions").then(function(data){var text=$interpolate(data.text)($rootScope);$scope.document=text})}).controller("WAIDIDMProfileNavbarCtrl",function($scope,$rootScope){$scope.goToFieldSet=function(fieldSet){$rootScope.$broadcast("waid.idm.action.goToFieldSet",fieldSet)}}).controller("WAIDIDMProfileCtrl",function($scope,$rootScope,waidCore,waidService,$filter,$timeout,$q){$scope.model={},$scope.goToFieldSet=function(fieldSet){$rootScope.$broadcast("waid.idm.action.goToFieldSet",fieldSet)},$rootScope.$on("waid.idm.action.goToFieldSet",function(event,fieldSet){$scope.currentFieldSet=fieldSet,$scope.errors=[]}),$scope.waid=waidCore,$scope.profileDefinition=waidCore.config.idm.profileDefinition,$scope.telephoneNumbers=[],$scope.addresses=[],$scope.inactiveEmails=[],$scope.activeEmails=[],$scope.email={add:""},$scope.errors=[],$scope.isUploading=!1,$scope.changedFields=[],$scope.showFieldSet=function(fieldSet){return fieldSet==$scope.currentFieldSet},$scope.getActiveFieldSetMenuClass=function(fieldSet){return fieldSet==$scope.currentFieldSet?"active":""},$scope.getAllFieldDefinitions=function(){for(var fieldDefinitions=[],i=0;$scope.profileDefinition.fieldSet.length>i;i++)if("undefined"!=typeof $scope.profileDefinition.fieldSet[i].fieldDefinitions)for(var a=0;$scope.profileDefinition.fieldSet[i].fieldDefinitions.length>a;a++)fieldDefinitions.push($scope.profileDefinition.fieldSet[i].fieldDefinitions[a]);return fieldDefinitions},$scope.dateOptions={dateDisabled:!1,maxDate:new Date,minDate:new Date(1940,1,1),startingDay:1,datepickerMode:"year"},$scope.popup={opened:!1},$scope.open=function(){$scope.popup.opened=!0},$scope.fieldChange=function(fieldName){$scope.changedFields.indexOf(fieldName)==-1&&$scope.changedFields.push(fieldName)},$scope.updateProfileInfo=function(){var defer=$q.defer();return waidService.userProfileGet().then(function(data){var data=$scope.formatDataFromApi(data);$scope.errors=[];for(var key in data)$scope.model[key]=data[key];waidCore.user=data,defer.resolve(data)},function(data){$scope.errors=data,defer.reject(data)}),defer.promise},$scope.uploadFile=function(files){if("undefined"!=typeof files&&files.length>0){$scope.isUploading=!0;var fd=new FormData;fd.append("file",files[0]),waidService.userAvatarPut(fd).then(function(data){angular.extend(waidCore.user,data),$timeout(function(){$scope.isUploading=!1},1e3)})}},$scope.formatDataFromApi=function(data){for(var fieldDefinitions=$scope.getAllFieldDefinitions(),i=0;fieldDefinitions.length>i;i++){var fieldDefinition=fieldDefinitions[i];if("date"!=fieldDefinition.type||"undefined"==typeof data[fieldDefinition.name]||!data[fieldDefinition.name]||data[fieldDefinition.name]instanceof Date);else{var dateParts=data[fieldDefinition.name].split("-");data[fieldDefinition.name]=new Date(dateParts[0],dateParts[1]-1,dateParts[2])}}return data},$scope.formatDataToApi=function(data){for(var fieldDefinitions=$scope.getAllFieldDefinitions(),fieldValues={},i=0;fieldDefinitions.length>i;i++){var fieldDefinition=fieldDefinitions[i];if("date"==fieldDefinition.type){if("undefined"!=typeof data[fieldDefinition.name]&&data[fieldDefinition.name]instanceof Date){fieldValues[fieldDefinition.name]=$filter("date")(data[fieldDefinition.name],"yyyy-MM-dd");continue}if("undefined"!=typeof data[fieldDefinition.name]&&!(data[fieldDefinition.name]instanceof Date)){fieldValues[fieldDefinition.name]=$filter("date")(new Date(data[fieldDefinition.name]),"yyyy-MM-dd");continue}}fieldValues[fieldDefinition.name]=data[fieldDefinition.name]}return fieldValues},$scope.saveMetadata=function(defaultMetadataPostData){var defer=$q.defer();return waidService.userApplicationMetadataPost(defaultMetadataPostData).then(function(data){defer.resolve(data)},function(data){angular.extend($scope.errors,data),defer.reject(data)}),defer.promise},$scope.saveDefault=function(defaultProfilePostData){var defer=$q.defer();return waidService.userProfilePatch(defaultProfilePostData).then(function(data){defer.resolve(data)},function(data){angular.extend($scope.errors,data),defer.reject(data)}),defer.promise},$scope.saveUsername=function(usernameProfilePostData){var defer=$q.defer();return waidService.userUsernamePut(usernameProfilePostData).then(function(data){defer.resolve(data)},function(data){angular.extend($scope.errors,data),defer.reject(data)}),defer.promise},$scope.savePassword=function(passwordProfilePostData){var defer=$q.defer();return waidService.userPasswordPut(passwordProfilePostData).then(function(data){defer.resolve(data)},function(data){angular.extend($scope.errors,data),defer.reject(data)}),defer.promise},$scope.save=function(forceProfileUpdate){$scope.errors=[];var dataPrepared=$scope.formatDataToApi($scope.model),fieldDefinitions=$scope.getAllFieldDefinitions(),collectMetadata=!1,defaultProfilePostData={},passwordProfilePostData={},usernameProfilePostData={},metadataProfilePostData={};for(var i in fieldDefinitions){var fieldDefinition=fieldDefinitions[i],storageType="undefined"!=typeof fieldDefinition.storageType?fieldDefinition.storageType:"default";if($scope.changedFields.indexOf(fieldDefinition.name)!=-1){if("username"==storageType){usernameProfilePostData[fieldDefinition.name]=dataPrepared[fieldDefinition.name];continue}if("password"==storageType){passwordProfilePostData[fieldDefinition.name]=dataPrepared[fieldDefinition.name];continue}if("none"==storageType)continue;"default"==storageType&&(defaultProfilePostData[fieldDefinition.name]=dataPrepared[fieldDefinition.name]),"metadata"==storageType&&(collectMetadata=!0)}"metadata"==storageType&&(metadataProfilePostData[fieldDefinition.name]=dataPrepared[fieldDefinition.name])}var promises=[];Object.keys(passwordProfilePostData).length&&promises.push($scope.savePassword(passwordProfilePostData)),Object.keys(usernameProfilePostData).length&&promises.push($scope.saveUsername(usernameProfilePostData)),Object.keys(defaultProfilePostData).length&&promises.push($scope.saveDefault(defaultProfilePostData)),Object.keys(metadataProfilePostData).length&&collectMetadata&&promises.push($scope.saveMetadata(metadataProfilePostData)),$scope.changedFields.indexOf("telephone_numbers")!=-1&&promises.push($scope.saveTelephoneList()),$scope.changedFields.indexOf("addresses")!=-1&&promises.push($scope.saveAddressList()),$q.all(promises).then(function(){$scope.errors=[],$rootScope.$broadcast("waid.idm.userProfile.save.ok"),$scope.currentFieldSet="overview",forceProfileUpdate&&$scope.updateProfileInfo(),$scope.changedFields=[]},function(errors){})},$scope.initEmails=function(data){if($scope.emails=data,$scope.inactiveEmails=[],$scope.activeEmails=[],data.length>0)for(var i=0;i<data.length;i++)1==data[i].is_verified?$scope.activeEmails.push(data[i]):$scope.inactiveEmails.push(data[i])},$scope.addEmailEnter=function(keyEvent){13===keyEvent.which&&($scope.addEmail($scope.email.add),keyEvent.preventDefault())},$scope.deleteEmail=function(id){waidService.userEmailDelete(id).then(function(data){$scope.errors=[],$scope.loadEmailList()},function(data){$scope.errors=data})},$scope.addEmail=function(){var data={email:$scope.email.add};waidService.userEmailPost(data).then(function(data){$scope.errors=[],$scope.loadEmailList(),$scope.email.add="",$rootScope.$broadcast("waid.idm.action.addEmail.ok",data)},function(data){$scope.errors=data})},$scope.loadEmailList=function(){waidService.userEmailListGet().then(function(data){$scope.initEmails(data.results)})},$scope.deleteTelephone=function(key){$scope.telephoneNumbers.splice(key,1)},$scope.changeTelephoneValue=function(fieldName,key){$scope.fieldChange(fieldName),$scope.checkNewTelephoneNumer()},$scope.checkTelephoneChanged=function(originalObject,newObject){return originalObject.number!=newObject.number},$scope.checkNewTelephoneNumer=function(){var lastItem=$scope.telephoneNumbers.slice(-1).pop();("undefined"==typeof lastItem||$scope.checkTelephoneAnyFieldFilled(lastItem))&&$scope.addNewTelephoneItem()},$scope.addNewTelephoneItem=function(){$scope.telephoneNumbers.push({id:"new",number:"",action:"",errors:[]})},$scope.checkTelephoneAnyFieldFilled=function(telephone){return""!=telephone.number},$scope.saveTelephoneList=function(){for(var i=0;i<$scope.telephoneNumbers.length;i++)if($scope.telephoneNumbers[i].action="",$scope.telephoneNumbers[i].errors=[],$scope.checkTelephoneAnyFieldFilled($scope.telephoneNumbers[i]))if("new"!=$scope.telephoneNumbers[i].id)for(var a=0;a<$scope.originalTelephoneNumbers.length;a++)$scope.originalTelephoneNumbers[a].id==$scope.telephoneNumbers[i].id&&$scope.checkTelephoneChanged($scope.originalTelephoneNumbers[a],$scope.telephoneNumbers[i])&&($scope.telephoneNumbers[i].action="change");else $scope.telephoneNumbers[i].action="new";for(var deleteTelephones=angular.copy($scope.originalTelephoneNumbers),a=0;a<deleteTelephones.length;a++)for(var i=0;i<$scope.telephoneNumbers.length;i++)"undefined"!=typeof deleteTelephones[a]&&"undefined"!=typeof deleteTelephones[a].id?deleteTelephones[a].id==$scope.telephoneNumbers[i].id&&deleteTelephones.splice(a,1):deleteTelephones.splice(a,1);for(var changeTelephone=function(i){var defer=$q.defer();return waidService.userTelephonePut($scope.telephoneNumbers[i].id,$scope.telephoneNumbers[i]).then(function(data){defer.resolve(data)},function(data){$scope.telephoneNumbers[i].errors=data,defer.reject(data)}),defer.promise},newTelephone=function(i){var defer=$q.defer();return waidService.userTelephonePost($scope.telephoneNumbers[i]).then(function(data){defer.resolve(data)},function(data){$scope.telephoneNumbers[i].errors=data,defer.reject(data)}),defer.promise},deleteTelephone=function(i){var defer=$q.defer();return waidService.userTelephoneDelete(deleteTelephones[i].id).then(function(data){defer.resolve(data)},function(data){$scope.telephoneNumbers[i].errors=data,defer.reject(data)}),defer.promise},promises=new Array,i=0;i<$scope.telephoneNumbers.length;i++)"change"==$scope.telephoneNumbers[i].action&&promises.push(changeTelephone(i)),"new"==$scope.telephoneNumbers[i].action&&promises.push(newTelephone(i));for(var i=0;i<deleteTelephones.length;i++)promises.push(deleteTelephone(i));var defer=$q.defer();return $q.all(promises).then(function(){$scope.loadTelephoneList(),defer.resolve()},function(errors){defer.reject(errors)}),defer.promise},$scope.saveAddressList=function(){for(var i=0;i<$scope.addresses.length;i++)if($scope.addresses[i].action="",$scope.addresses[i].errors=[],$scope.checkAddressAnyFieldFilled($scope.addresses[i]))if("new"!=$scope.addresses[i].id)for(var a=0;a<$scope.originalAddresses.length;a++)$scope.originalAddresses[a].id==$scope.addresses[i].id&&$scope.checkAddressChanged($scope.originalAddresses[a],$scope.addresses[i])&&($scope.addresses[i].action="change");else $scope.addresses[i].action="new";for(var deleteAddresss=angular.copy($scope.originalAddresses),a=0;a<deleteAddresss.length;a++)for(var i=0;i<$scope.addresses.length;i++)"undefined"!=typeof deleteAddresss[a]&&"undefined"!=typeof deleteAddresss[a].id?deleteAddresss[a].id==$scope.addresses[i].id&&deleteAddresss.splice(a,1):deleteAddresss.splice(a,1);for(var changeAddress=function(i){var defer=$q.defer();return waidService.userAddressPut($scope.addresses[i].id,$scope.addresses[i]).then(function(data){defer.resolve(data)},function(data){$scope.addresses[i].errors=data,defer.reject(data)}),defer.promise},newAddress=function(i){var defer=$q.defer();return waidService.userAddressPost($scope.addresses[i]).then(function(data){defer.resolve(data)},function(data){$scope.addresses[i].errors=data,defer.reject(data)}),defer.promise},deleteAddress=function(i){var defer=$q.defer();return waidService.userAddressDelete(deleteAddresss[i].id).then(function(data){defer.resolve(data)},function(data){$scope.addresses[i].errors=data,defer.reject(data)}),defer.promise},promises=new Array,i=0;i<$scope.addresses.length;i++)"change"==$scope.addresses[i].action&&promises.push(changeAddress(i)),"new"==$scope.addresses[i].action&&promises.push(newAddress(i));for(var i=0;i<deleteAddresss.length;i++)promises.push(deleteAddress(i));var defer=$q.defer();return $q.all(promises).then(function(){$scope.loadAddressList(),defer.resolve()},function(errors){defer.reject(errors)}),defer.promise},$scope.loadTelephoneList=function(){waidService.userTelephoneListGet().then(function(data){$scope.telephoneNumbers=data.results,$scope.originalTelephoneNumbers=angular.copy($scope.telephoneNumbers),$scope.checkNewTelephoneNumer()})},$scope.changeAddressValue=function(fieldName,addressField,key){$scope.fieldChange(fieldName),$scope.checkNewAddress()},$scope.addNewAddress=function(){$scope.addresses.push({id:"new",address:"",city:"",zipcode:"",country:"",action:"",errors:[]})},$scope.checkAddressChanged=function(originalObject,newObject){return originalObject.address!=newObject.address||(originalObject.zipcode!=newObject.zipcode||(originalObject.city!=newObject.city||originalObject.country!=newObject.country))},$scope.deleteAddress=function(key){$scope.addresses.splice(key,1)},$scope.checkAddressAnyFieldFilled=function(address){return""!=address.address||(""!=address.zipcode||(""!=address.city||""!=address.country))},$scope.checkNewAddress=function(){var lastItem=$scope.addresses.slice(-1).pop();("undefined"==typeof lastItem||$scope.checkAddressAnyFieldFilled(lastItem))&&$scope.addNewAddress()},$scope.loadAddressList=function(){waidService.userAddressListGet().then(function(data){$scope.addresses=data.results,$scope.originalAddresses=angular.copy($scope.addresses),$scope.checkNewAddress()})},$scope.getMultipleCheckBoxName=function(fieldDefinition,key){for(var i=0;fieldDefinition.data.length>i;i++)if(fieldDefinition.data[i].id==key)return fieldDefinition.data[i].name;return"Unknown"},$scope.loadApplicationMetadata=function(){waidService.userApplicationMetadataGet().then(function(data){for(var fieldDefinitions=$scope.getAllFieldDefinitions(),i=0;fieldDefinitions.length>i;i++){var storageType="undefined"!=typeof fieldDefinitions[i].storageType?fieldDefinitions[i].storageType:"default";"metadata"==storageType&&"undefined"!=typeof data[fieldDefinitions[i].name]&&($scope.model[fieldDefinitions[i].name]=data[fieldDefinitions[i].name])}})},$scope.providers=[],$scope.getProviders=function(){waidService.socialProviderListGet().then(function(data){$scope.providers=data})},$scope.init=function(){$scope.updateProfileInfo(),$scope.loadApplicationMetadata(),$scope.loadEmailList(),$scope.loadTelephoneList(),$scope.loadAddressList(),$scope.getProviders()},$scope.init()}).controller("WAIDIDMCompleteProfileCtrl",function($scope,$location,$window,waidService){$scope.mode="complete"}).controller("WAIDIDMLinkSocialProfileCtrl",function($scope,$location,$window,waidService){$scope.model={password:""},$scope.errors=[],$scope.linkSocialProfile=function(){$scope.errors=[],waidService.userLinkSocialProfilePost($scope.model).then(function(data){$scope.errors=[]},function(data){$scope.errors=data})}}).controller("WAIDIDMLoginCtrl",function($scope,$location,waidService,waidCore){$scope.waid=waidCore,$scope.model={username:"",password:""},$scope.errors=[],$scope.login=function(){waidService.userLoginPost($scope.model).then(function(data){},function(data){$scope.errors=data})}}).controller("WAIDIDMLostLoginCtrl",function($scope,$rootScope,$location,waidService,waidCore){$scope.waid=waidCore,$scope.model={email:""},$scope.errors=[],$scope.submit=function(){waidService.userLostLoginPost($scope.model).then(function(data){$rootScope.$broadcast("waid.idm.action.lostLogin.ok",data),$scope.errors=[]},function(data){$scope.errors=data})}}).controller("WAIDIDMSocialCtrl",function($scope,$rootScope,$location,waidService,$window,waidCore){$scope.waid=waidCore,$scope.providers=[],$scope.getProviders=function(){waidService.socialProviderListGet().then(function(data){for(var i=0;i<data.length;i++)data[i].url=data[i].url+"?return_url="+encodeURIComponent(waidCore.getAlCodeUrl());$scope.providers=data})},$scope.goToSocialLogin=function(provider){$rootScope.$broadcast("waid.idm.action.associateSocial",{action:"associate_unknown_user",provider:provider}),$window.location.assign(provider.url)},$scope.getProviders()}).controller("WAIDIDMAssociatedSocialAccountsCtrl",function($scope,$rootScope,$location,waidService,$window,waidCore){$scope.waid=waidCore,$scope.providers=[],$scope.getProviders=function(){waidService.socialProviderListGet().then(function(data){for(var i=0;i<data.length;i++)data[i].url=data[i].url+"?waid="+encodeURIComponent(data[i].waid_data)+"&return_url="+encodeURIComponent(waidCore.getAlCodeUrl());$scope.providers=data})},$scope.associateSocialAction=function(provider){provider.linked?($rootScope.$broadcast("waid.idm.action.associateSocial",{action:"delete",provider:provider}),waidService.userAssociateSocialDelete(provider.backend).then(function(){$scope.getProviders()})):($rootScope.$broadcast("waid.idm.action.associateSocial",{action:"associate_known_user",provider:provider}),$window.location.assign(provider.url))},$scope.getProviders()}).controller("WAIDIDMRegisterCtrl",function($scope,$route,waidService,$location,$uibModal,waidCore){$scope.waid=waidCore,$scope.show={},$scope.missingEmailVerification=!1,"complete"==$scope.modus?waidService.userCompleteProfileGet().then(function(data){$scope.model=data.user,"undefined"!=typeof data.profile_status&&data.profile_status.indexOf("email_is_not_verified")!==-1&&($scope.missingEmailVerification=!0);for(var i=0;i<data.missing_data.length;i++)$scope.show[data.missing_data[i]]=!0},function(data){}):($scope.missingEmailVerification=!1,$scope.show={username:!0,password:!0,email:!0,terms_and_conditions_check:!0}),$scope.register=function(){$scope.model.terms_and_conditions_check&&($scope.errors=[],"complete"==$scope.modus?waidService.userCompleteProfilePost($scope.model).then(function(data){$scope.model={}},function(data){$scope.errors=data}):waidService.userRegisterPost($scope.model).then(function(data){$scope.model={}},function(data){$scope.errors=data}))}}),angular.module("waid.idm.directives",["waid.core","waid.idm.controllers"]).directive("waidProfile",function(waidCore){return{restrict:"E",controller:"WAIDIDMProfileCtrl",scope:{currentFieldSet:"@"},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","profile")}}}).directive("waidLinkSocialProfile",function(waidCore){return{restrict:"E",controller:"WAIDIDMLinkSocialProfileCtrl",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","linkSocialProfile")}}}).directive("waidUserProfileNavbar",function(waidCore){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","userProfileNavbar")}}}).directive("waidUserProfileStatusButton",function(waidCore){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","userProfileStatusButton")}}}).directive("waidLoginAndRegisterHome",function(waidCore){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","loginAndRegisterHome")}}}).directive("waidLogin",function(waidCore){return{restrict:"E",controller:"WAIDIDMLoginCtrl",scope:{},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","login")}}}).directive("waidRegister",function($rootScope,waidCore){return{restrict:"E",controller:"WAIDIDMRegisterCtrl",scope:{modus:"@"},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","register")}}}).directive("waidSocialLogin",function(waidCore){return{restrict:"E",controller:"WAIDIDMSocialCtrl",scope:{},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","socialLogin")}}}).directive("waidLostLogin",function(waidCore){return{restrict:"E",controller:"WAIDIDMLostLoginCtrl",scope:{},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","lostLogin")}}}).directive("waidAssociatedSocialAccounts",function(waidCore){return{restrict:"E",controller:"WAIDIDMAssociatedSocialAccountsCtrl",scope:{},templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("idm","associatedSocialAccounts")}}}),angular.module("waid.comments",["waid.core","waid.idm","waid.comments.controllers","waid.comments.directives"]).run(function(waidCore,waidCoreStrategy,waidCoreAppStrategy,waidService){waidCore.config.setConfig("comments",{templates:{commentsHome:"/templates/comments/comments-home.html",commentsOrderButton:"/templates/comments/comments-order-button.html",commentsItem:"/templates/comments/comment-item.html"},translations:{postCommentButton:"Plaats comment",actionDropdownTitle:"Opties",editCommentTitle:"Aanpassen",markCommentSpamTitle:"Markeer als spam",commentMarkedAsSpam:"Gemarkeerd als spam!",deleteCommentTitle:"Verwijderen",confirmDeleteContentBody:"Weet je zeker dat je de comment wilt verwijderen?",confirmDeleteContentTitle:"Comment verwijderen?",updateCommentButton:"Aanpassen",voteOrderNewestFirst:"Nieuwste eerst",voteOrderOldestFirst:"Oudste eerst",voteOrderTopFirst:"Top comments",addEmoticonButtonText:"Emoji toevoegen",isLockedTitle:"Comment is gelocked",loadMoreComments:"Laad meer"}})}),angular.module("waid.comments.controllers",["waid.core","waid.core.strategy","waid.core.app.strategy"]).controller("WAIDCommentsCtrl",function($scope,$rootScope,waidService,$q,waidCore,waidCoreStrategy,waidCoreAppStrategy){$scope.ordering=angular.isDefined($scope.ordering)?$scope.ordering:"-created",$scope.orderingEnabled=!angular.isDefined($scope.orderingEnabled)||"false"!=$scope.orderingEnabled,$scope.objectId=angular.isDefined($scope.objectId)?$scope.objectId:"currenturl",$scope.waid=$rootScope.waid,$scope.comment={comment:""},$scope.limit=10,$scope.offset=0,$scope.showMore=!1,$scope.orderCommentList=function(ordering){$scope.ordering=ordering,$scope.loadComments()},$scope.voteComment=function(comment,vote){$rootScope.waid.user?waidService.commentVotePost(comment.id,vote).then(function(data){comment.vote_up_count=data.vote_up_count,comment.vote_down_count=data.vote_down_count,comment.vote_count=data.vote_count}):waidCore.openLoginAndRegisterHome()},$scope.markComment=function(comment,mark){waidService.commentMarkPost(comment.id,mark).then(function(data){comment.marked_as_spam=data.marked_as_spam})},$scope.editComment=function(comment){return!comment.is_locked&&void(comment.is_edit=!0)},$scope.updateComment=function(comment){var patch_comment={comment:comment.comment_formatted};waidService.userCommentPatch(comment.id,patch_comment).then(function(data){comment.is_edit=!1,comment.comment_formatted=data.comment_formatted,comment.comment=data.comment})},$scope.deleteComment=function(comment){waidService.userCommentDelete(comment.id).then(function(data){var index=$scope.comments.indexOf(comment);$scope.comments.splice(index,1)})},$scope.processComments=function(comments){for(var i=0;i<comments.length;i++)comments[i].is_edit=!1,comments[i].user.id==$rootScope.waid.user.id&&(comments[i].is_owner=!0),"undefined"!=typeof comments[i].children&&comments[i].children&&comments[i].children.length>0&&(comments[i].children=$scope.processComments(comments[i].children));return comments},$scope.loadComments=function(append){var params={object_id:$scope.objectId,ordering:$scope.ordering};if("undefined"==typeof append){var append=!1;$scope.offset=0}else var append=!0;params.limit=$scope.limit,append&&($scope.offset=$scope.offset+$scope.limit,params.offset=$scope.offset),waidService.commentListGet(params).then(function(data){if(0==data.results.length||data.results.length<$scope.limit?$scope.showMore=!1:$scope.showMore=!0,data.results.length>0)if(data.results=$scope.processComments(data.results),append)for(var i=0;data.results.length>i;i++)$scope.comments.push(data.results[i]);else $scope.comments=data.results})},$scope.post=function(){$scope.comment.object_id=$scope.objectId,$rootScope.waid.user?waidService.userCommentPost($scope.comment).then(function(data){$scope.comment.comment="",$scope.loadComments()}):(waidCore.setLastAction("comment_post",$scope.comment),waidCore.openLoginAndRegisterHome(),$scope.comment.comment="")},$scope.addEmoji=function(targetId,comment){if(comment.id)var commentText=comment.comment_formatted;else var commentText=comment.comment;waidCore.openEmoticonsModal(targetId,commentText).then(function(data){if(comment.id)for(var i=0;i<$scope.comments.length;i++)($scope.comments[i].id=comment.id)&&($scope.comments[i].comment=data,$scope.comments[i].comment_formatted=data);else $scope.comment.comment=data})},$scope.$on("waid.core.lastAction.commentPost",function(data){$scope.loadComments()})}),angular.module("waid.comments.directives",["waid.core","waid.comments.controllers"]).directive("waidComments",function(waidCore,$window){return{restrict:"E",scope:{ordering:"@?",objectId:"@?",orderingEnabled:"@?"},controller:"WAIDCommentsCtrl",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("comments","commentsHome")},link:function($scope,$element,attr){function elementInViewport(el){for(var top=el.offsetTop,left=el.offsetLeft,width=el.offsetWidth,height=el.offsetHeight;el.offsetParent;)el=el.offsetParent,
top+=el.offsetTop,left+=el.offsetLeft;var load=top>=window.pageYOffset&&left>=window.pageXOffset&&top+height<=window.pageYOffset+window.innerHeight&&left+width<=window.pageXOffset+window.innerWidth;load&&($scope.loadComments(),isLoaded=!0)}var isLoaded=!1;$(window).scroll(function(){isLoaded||elementInViewport($element[0])}),elementInViewport($element[0])}}}).directive("waidCommentsOrderButton",function(waidCore){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("comments","commentsOrderButton")}}}).directive("waidCommentsItem",function(waidCore){return{scope:{comment:"=",markComment:"=",editComment:"=",deleteComment:"=",voteComment:"=",updateComment:"=",addEmoji:"=",waid:"="},restrict:"E",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("comments","commentsItem")}}}),angular.module("waid.rating",["waid.core","waid.idm","waid.rating.controllers","waid.rating.directives"]).run(function(waidCore,waidCoreStrategy,waidCoreAppStrategy,waidService){waidCore.config.setConfig("rating",{templates:{ratingWidget:"/templates/rating/widget.html"},translations:{}})}),angular.module("waid.rating.controllers",["waid.core","waid.core.strategy","waid.core.app.strategy"]).controller("WAIDRatingCtrl",function($scope,$rootScope,waidCore,waidService,waidCoreStrategy,waidCoreAppStrategy){$scope.objectId=angular.isDefined($scope.objectId)?$scope.objectId:"currenturl",$scope.stars=[{active:!1,value:1},{active:!1,value:2},{active:!1,value:3},{active:!1,value:4},{active:!1,value:5}],$scope.rating={average:0,total_votes:0,rating:[]},$scope.rate=function(value){var data={object_id:$scope.objectId,value:value};$rootScope.waid.user?waidService.ratingPost(data).then(function(data){$scope.rating=data,$scope.rateOut()}):(waidCore.setLastAction("rating_post",data),waidCore.openLoginAndRegisterHome())},$scope.rateOver=function(value){for(var i=0;$scope.stars.length>i;i++)i<value?$scope.stars[i].active=!0:$scope.stars[i].active=!1},$scope.rateOut=function(){for(var average_rounded=Math.round($scope.rating.average),i=0;$scope.stars.length>i;i++)i<average_rounded?$scope.stars[i].active=!0:$scope.stars[i].active=!1},$scope.loadRating=function(){waidService.ratingGet($scope.objectId).then(function(data){$scope.rating=data,$scope.rateOut()})},$scope.$on("waid.core.lastAction.ratingPost",function(data){$scope.loadRating()})}),angular.module("waid.rating.directives",["waid.core","waid.rating.controllers"]).directive("waidRating",function(waidCore){return{restrict:"E",scope:{objectId:"@?"},controller:"WAIDRatingCtrl",templateUrl:function(elem,attrs){return attrs.templateUrl||waidCore.config.getTemplateUrl("rating","ratingWidget")},link:function($scope,$element,attr){function elementInViewport(el){for(var top=el.offsetTop,left=el.offsetLeft,width=el.offsetWidth,height=el.offsetHeight;el.offsetParent;)el=el.offsetParent,top+=el.offsetTop,left+=el.offsetLeft;var load=top>=window.pageYOffset&&left>=window.pageXOffset&&top+height<=window.pageYOffset+window.innerHeight&&left+width<=window.pageXOffset+window.innerWidth;load&&($scope.loadRating(),isLoaded=!0)}var isLoaded=!1;$(window).scroll(function(){isLoaded||elementInViewport($element[0])}),elementInViewport($element[0])}}});